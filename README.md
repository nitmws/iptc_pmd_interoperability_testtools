# IPTC Photo Metadata Interoperability Test Tools

Tools for checking different implementations of the IPTC Photo Metadata Standard

The [IPTC Photo Metadata Working Group](https://iptc.org/about-iptc/work-structure/#pmd) considers to define a test suite for checking if the implementation of dealing with IPTC Photo Metadata and related Exif Tags by an imaging software aligns with the specifications and basic processing rules.


The [IPTC Photo Metadata (PMD) Standard](https://www.iptc.org/std/photometadata/specification/IPTC-PhotoMetadata) specifies currently 57 properties, many of them have a structure of sub-properties. Checking if an imaging software is able to populate all of them, or if some properties of an imported image are removed during the export by it would be hard work by humand eyes and hands (for ticking a checklist).

To execute the tests in a quick and easy way raised the question: couldn't this be done by a script?

This repository provides answers to this question. Currently, these checks are supported:
* Checking if all IPTC PMD properties exist in an image file, and list which are missing.
* Checking if all IPTC PMD properties exist in an image file, list which are missing, and compare the values of existing properties with the value of the same property in a reference image file.
* Investigating IPTC PMD in an image file: based on the IPTC PMD standard check for each specified property:
  * does the corresponding XMP field exist
  * if specified: does the corresponding IIM field exist
  * if an XMP and an IIM field are specified: check if their values are synchronized.
  * if the PMD property and its XMP field are a structure: check if the properties specified inside the structure exist. Do this recursively.


## Processing Overview

### Structure of the Folders

* files: holds all variable files of the test procedures:
  * backup: all tested files are saved here after the test
  * cache: keeps all temporary helper files
  * reference: keeps the IPTC PMD Standard reference files: a JPEG file with all properties specified by the standard populated and embedded, a corresponding JSON file as it is generated by ExifTool
  * investigate1: holds all image files for investigating its existing IPTC PMD 
  * test2: holds all to-be-tested files for Test2 as outlined by IPTC
  * test3: holds all to-be-tested files for Test3 as outlined by IPTC
  * testresults: holds all files generated during the test procedures
* scripts: holds all main Python (and other) script files used for the test procedures 
  * config: configuration files for the tests
  * pmdtools: scripts or other software required as tools for the test procedures
    
### Basic Test Procedure

* A Python script is started to execute a test
* The script searches for *.jpg and *.png image files in the test2 or test3 folder and keeps a list of found file names.
* The script iterates across the list of found file names and processes each one:
    * Metadata is retrieved from the image file by ExifTool and a corresponding JSON file is created.
    * The properties of the JSON file of the IPTC reference image are matched against the properties in the just generated JSON file ...
    * ... depending on the goals of the script the results of this matching is recorded in file(s) with the same basic filename as the image file.
    * After the tests the image file is moved from the test2/test3 folder to the corresponding backup folder.
  
    
### Available Test Scripts

* Checkfor_missing_props.py: all top level properties of the IPTC PMD Standard and if defined all sub-properties are matched against the properties found in an image file. If an IPTC PMD Standard property is not found in the tested image file this property is recorded in a text file in the testresults folder.

* Compare_prop_values.py: all top level properties of the IPTC PMD Standard and if defined all sub-properties are matched against the properties found in an image file and their values are compared. If a property is not found and if the value of a found property is not the same as in the IPTC reference image file this is recorded in a text file in the testresults folder.

### PMD Investigation

* Read the IPTC PMD specification from the config/iptc-pmd-techguide.yml file
* Interate across the top level properties:
  * Does the corresponding XMP field exist
  * If specified: does the corresponding IIM field eixst
  * If both exist and if the data type is a plain string or a number: compare the values, check if they are synchronized
  * If the data type of the property is structure: check if the specified properties of the structure exist 
    * If the data type of a property is structure investigage it recursively.
* Record the results in a CSV file: columns cover property names, if IIM and XMP fields exist and - if testable - if the values are in sync. Each investigated property is a row (currently about 170).

### Use of ExifTool

[ExifTool](https://exiftool.org) is a highly appreciated and widely used open source tool for embedding and retrieving a rich set of photo metadata. (Note: IPTC and Exif are the most prominent photo metadata standards but others, with a focus on special types of image content, exist too.) 

To run the test scripts of this repository it is required to have ExifTool installed on the computer running the scripts and that ExifTool can be called from the command line by a simple "exiftool" command without a path to the file.

